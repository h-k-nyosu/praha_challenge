## 回答1

### 前提
次のようなユースケースの範囲で、チャットアプリのテーブル設計をしていきます。

- 会員登録
  - メールアドレスを入力したら、認証メールが届く
  - 認証メールが届いて、そのリンクを踏んだらメールアドレスでの会員登録が完了
  - メールが重複している場合は、エラーを表示する

- ワークスペースに参加する
  - ワークスペース参加ユーザーに一人追加する
  - ワークスペースの初期参加チャンネルにも参加する
  - ワークスペースのチャンネル一覧とデフォルトチャンネルを表示する

- ワークスペースを検索する
  - ワークスペースDBから検索結果を取得する
  - ワークスペースの検索結果を表示する

- ワークスペース（TOP）を閲覧する
  - ワークスペース参加者であるかを照合する
  - ユーザーが参加しているチャンネル一覧を取得する
  - 参加チャンネルの中で、デフォルト表示のチャンネルメッセージ内容を表示

- ワークスペースを作成する
  - ユーザーがワークスペース情報を入力する
  - ワークスペースIDが重複していないか確認
  - 招待メンバーを追加する（スキップ可能）
  - ワークスペースが作成される
  - 招待メンバーに認証メールを送る
  - 認証メールを踏むと、ユーザーがワークスペース参加者に追加される

- チャンネルを作成する
  - チャンネル作成ボタンを押す
  - チャンネル名を入力する
  - チャンネルに招待するユーザを選択する
  - チャンネルが作成される
  - 招待された人がチャンネル参加ユーザーに追加される
  - チャンネルに招待された旨のメッセージが追加される

- チャンネルに招待する
  - 招待するユーザーを選択する
  - 招待された人がチャンネル参加ユーザーに追加される
  - チャンネルに招待された旨のメッセージが追加される

- メッセージを投稿する
  - メッセージを入力して送信する
  - メッセージがDBに反映される
  - チャンネル参加ユーザーにメッセージ更新リクエストを送る
  - チャンネル参加者であればリクエストを反映し、UI上に新しくメッセージが追加される

- スレッドメッセージを投稿する
  - メッセージのスレッドに文章を入力して送信する
  - スレッドメッセージがDBに反映される
  - チャンネル参加ユーザーにスレッドメッセージ更新リクエストを送る
  - チャンネル参加者であればリクエストを反映し、UI上に新しくスレッドメッセージが追加される

- メッセージを削除する
  - メッセージを削除するボタンを押す
  - メッセージのDBデータを削除ステータスに変更する
  - チャンネル参加ユーザーにメッセージ更新リクエストを送る
  - チャンネル参加者であればリクエストを反映し、UI上のメッセージを削除する

- メッセージを編集する
  - 編集後メッセージを入力して編集ボタンを押す
  - メッセージのDBデータの内容を更新して、ステータスも編集済みステータスに変更する
  - チャンネル参加ユーザーにメッセージ更新リクエストを送る
  - チャンネル参加者であればリクエストを反映し、UI上のメッセージを編集する（メッセージには編集済みと表記）

- ワークスペースを脱退する
  - ワークスペースを脱退するボタンを押す
  - チャンネル参加者リストの該当ユーザーのステータスを脱退済み等に変更する
  - ワークスペース参加者リストの該当ユーザーのステータスを脱退済み等に変更する
  - ユーザープロフィールを見ると脱退済みと記載される

- チャンネルを脱退する
  - ワークスペースを脱退するボタンを押す
  - チャンネル参加者リストの該当ユーザーのステータスを脱退済み等に変更する
  - ユーザープロフィールをみると脱退済みと記載される

- メッセージを検索する
  - ワークスペース内のフリーワードで検索をする
  - そのワークスペースの参加チャンネルの中で、フリーワードを含むメッセージとスレッドメッセージを表示する



次のようなスキーマを考えました。


イミュータブルデータモデリングの概念を少し取り入れたバージョン

<img src="./images/db_modeling2_02.svg" style="width:2000px">
